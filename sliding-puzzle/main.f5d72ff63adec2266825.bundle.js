(()=>{"use strict";const e=new Audio("./assets/sounds/tile-move.mp3"),t=new Audio("./assets/sounds/no-move.mp3"),n=new Audio("./assets/sounds/shuffle.mp3"),o=new Audio("./assets/sounds/cheeky_monkey.mp3");o.loop=!0;const s=new Audio("./assets/sounds/win.mp3"),a=new Audio("./assets/sounds/mouse_click.mp3"),i='<svg height="80" width="80" viewBox="0 0 512 512" style="cursor: pointer;">\n<path\n  fill="#FFFFFF"\n  d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"\n></path>\n</svg>',d='<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="30" height="30" viewBox="0 0 75 75" stroke="#111" stroke-width="5">\n<path d="m39,14-17,15H6V48H22l17,15z" fill="#111" stroke-linejoin="round"/>\n<path d="m49,26 20,24m0-24-20,24" fill="none" stroke-linecap="round"/>\n</svg>';function r(e,t){return e.boardSize!==t.boardSize?t.boardSize-e.boardSize:e.moves!==t.moves?e.moves-t.moves:e.minutes!==t.minutes?e.mintes-t.minutes:e.seconds!==t.seconds?e.seconds-t.seconds:0}function l([e,t],n){return[0===t?null:[e,t-1],e===n-1?null:[e+1,t],t===n-1?null:[e,t+1],0===e?null:[e-1,t]].filter((e=>null!==e))}function c(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function m(e){const t=e;for(let e=0;e<t.length;e+=1)clearTimeout(t[e]);t.length=0}const u=document.getElementsByTagName("body")[0],p=document.createElement("div");p.className="container";const f=document.createElement("div");f.className="menu-container";const h=document.createElement("div"),g=document.createElement("div");g.innerText="choose board size:",h.appendChild(g);const v=document.createElement("div");v.className="board-size",v.innerHTML='<ul><li data-size="3">3x3</li> <li data-size="4">4x4</li> <li data-size="5">5x5</li> <li data-size="6">6x6</li> <li data-size="7">7x7</li> <li data-size="8">8x8</li></ul>',h.appendChild(v);const y=document.createElement("div"),b=document.createElement("div");b.innerText="board tiles as:",y.appendChild(b);const L=document.createElement("div");L.className="tiles-style",L.innerHTML='<ul><li data-tilesstyle="numbers">numbers</li> <li data-tilesstyle="images">images</li></ul>',y.appendChild(L);const k=document.createElement("div");k.className="sound",k.innerHTML=d;const E=document.createElement("div");E.className="save-game",E.innerHTML="save<br>game";const T=document.createElement("div");T.className="load-game",T.innerHTML="load<br>game";const w=document.createElement("div");w.className="best-scores",w.innerHTML="best<br>scores";const x=document.createElement("div");x.className="solve-puzzle",x.innerHTML="solve<br>puzzle";const C=document.createElement("button");C.className="hamburger",C.setAttribute("onclick",'this.classList.toggle("opened");this.setAttribute("aria-expanded", this.classList.contains("opened"))'),C.setAttribute("aria-label","Main Menu"),C.innerHTML='<svg width="70" height="70" viewBox="0 0 100 100">\n<path class="line line1" d="M 20,29.000046 H 80.000231 C 80.000231,29.000046 94.498839,28.817352 94.532987,66.711331 94.543142,77.980673 90.966081,81.670246 85.259173,81.668997 79.552261,81.667751 75.000211,74.999942 75.000211,74.999942 L 25.000021,25.000058" />\n<path class="line line2" d="M 20,50 H 80" />\n<path class="line line3" d="M 20,70.999954 H 80.000231 C 80.000231,70.999954 94.498839,71.182648 94.532987,33.288669 94.543142,22.019327 90.966081,18.329754 85.259173,18.331003 79.552261,18.332249 75.000211,25.000058 75.000211,25.000058 L 25.000021,74.999942" />\n</svg>',f.appendChild(E),f.appendChild(T),f.appendChild(h),f.appendChild(y),f.appendChild(w),f.appendChild(x),f.appendChild(k),p.appendChild(C);const M=document.createElement("div"),S=document.createElement("button");S.id="pause",S.innerText="Play";const P=document.createElement("button");P.id="new-game",P.innerText="New Game",M.appendChild(S),M.appendChild(P),M.className="game-controls";const F=document.createElement("div");F.className="board-container";const $=document.createElement("div");$.className="overlay-container",$.innerHTML=i;const N=document.createElement("div"),z=document.createElement("span");z.id="moves",z.innerText="Moves: 0";const H=document.createElement("span");H.id="time",H.innerText="Time: 00:00",N.appendChild(z),N.appendChild(H),N.className="game-stats",p.appendChild(f),p.appendChild(M),p.appendChild(F),p.appendChild($),p.appendChild(N),u.appendChild(p);const A=[];let I,W=4,K="numbers",j=!0,B=!1,G=0,O=0,J=!1,R=c(1,150);const D=[];let V=!0;function _(e,t){let[n,o]=[e,t];[n,o]=function(e,t){const[n,o]=[e,t];let s=1;for(let e=0;e<o;e+=1)for(let t=0;t<o;t+=1)void 0===n[e]&&n.push([]),n[e][t]=e===o-1&&t===o-1?0:s,s+=1;return[n,o]}(n,o);let s=[o-1,o-1];for(let e=0;e<o**5;e+=1){const e=l(s,o),t=e[Math.floor(Math.random()*e.length)],a=n[t[0]][t[1]];n[s[0]][s[1]]=a,n[t[0]][t[1]]=0,s=[t[0],t[1]]}return function(e){const t=e.length;let n=1;for(let o=0;o<t;o+=1)for(let s=0;s<t;s+=1)if(e[o][s]===n)n+=1;else{if(0!==e[t-1][t-1])return!1;n+=1}return!0}(n)?_(n,o):n}function q(e){j=!0,I=F.clientWidth,F.innerHTML="";for(let t=0;t<W;t+=1)for(let t=0;t<W;t+=1){const t=e.pop(),n=document.createElement("div");if(0===t)n.dataset.id="empty",n.className="empty";else{if(n.dataset.id=t,"numbers"===K)n.innerText=t;else{const e=Math.floor((t-1)/W),o=Math.floor((t-1)%W),s=F.clientWidth/W*o,a=F.clientHeight/W*e;n.dataset.x=s,n.dataset.y=a,n.style.backgroundImage=`url("./assets/images/${R}.jpg")`,n.style.backgroundSize=`${F.clientWidth}px ${F.clientHeight}px`,n.style.backgroundRepeat="no-repeat",n.style.backgroundPosition=`-${s}px -${a}px`}n.setAttribute("draggable","true"),n.className="tile"}F.appendChild(n)}F.style.gridTemplateColumns=`repeat(${W}, ${W}fr)`,F.style.gridTemplateRows=`repeat(${W}, ${W}fr)`,z.innerText="Moves: "+G;const t=(O%60).toString().padStart(2,"0"),n=Math.floor(O/60).toString().padStart(2,"0");H.innerText=`Time: ${n}:${t}`}function X(){const e=F.children;let t=0;for(let n=1;n<=e.length;n+=1)n===Number(e[n-1].dataset.id)&&(e[n-1].classList.add("in-place"),t+=1);t===W**2-1&&function(){V||s.play(),$.classList.remove("hidden"),"images"===K&&($.style.backgroundImage=`url("./assets/images/${R}.jpg")`);const e=`Hooray!<br> You solved ${W}x${W} ${K} puzzle in ${Math.floor(O/60).toString().padStart(2,"0")}:${(O%60).toString().padStart(2,"0")} and ${G} moves`;$.innerHTML=e,S.innerHTML="Refresh",B=!0,j=!0,function(e,t,n,o){let s=JSON.parse(localStorage.getItem("bestScores"));s||(s=[]),s.push({boardSize:e,moves:t,minutes:n,seconds:o}),s=s.sort(r),s.length>10&&(s.length=10),localStorage.setItem("bestScores",JSON.stringify(s))}(W,G,Math.floor(O/60),O%60)}()}function Y(){m(D),G=0,O=0,A.length=0,$.style.backgroundImage="none",R=c(1,150),B=!1,$.innerHTML=i,$.classList.remove("hidden"),V||n.play(),S.innerText="Play",_(A,W),q(A.flat().reverse()),X()}function Q(){if(j)return;O+=1;const e=(O%60).toString().padStart(2,"0"),t=Math.floor(O/60).toString().padStart(2,"0");H.innerText=`Time: ${t}:${e}`,setTimeout(Q,1e3)}function U(){if(m(D),$.innerHTML=i,V||a.play(),B)return B=!1,void Y();j=!j,j?$.classList.remove("hidden"):(Q(),$.classList.add("hidden")),S.innerText=j?"Play":"Pause"}function Z(e,t){const[n,o]=[e,t],s=n.dataset.id;if(n.innerText="",n.dataset.id="empty",n.className="empty",n.removeAttribute("draggable"),o.dataset.id=s,o.setAttribute("draggable","true"),"numbers"===K)o.innerText=s,o.className="tile";else{const[e,t]=[n.dataset.x,n.dataset.y];n.dataset.x="",n.dataset.y="",o.dataset.x=e,o.dataset.y=t,n.removeAttribute("style"),o.style.opacity=0,o.style.backgroundImage=`url("./assets/images/${R}.jpg")`,o.style.backgroundSize=`${F.clientWidth}px ${F.clientHeight}px`,o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition=`-${e}px -${t}px`,setTimeout((()=>{o.style.opacity=1}),75),o.className="tile"}}function ee(t,n,o){if(J)return;J=!0,setTimeout((()=>{J=!1}),300);const[s,a]=[t,n];V||e.play(),o?(Z(s,a),X()):(function(e,t){const[n,o]=[e,t],s=o.offsetLeft-n.offsetLeft,a=o.offsetTop-n.offsetTop;n.style.transform=`translate(${s}px, ${a}px)`,setTimeout((()=>{n.style.transform="translate(0, 0)"}),200)}(s,a),setTimeout((()=>{Z(s,a),X()}),200)),G+=1,z.innerText="Moves: "+G}function te(){V||a.play(),f.classList.toggle("opened"),f.classList.contains("opened")?j=!0:"Pause"===S.innerHTML&&(j=!1,Q())}S.addEventListener("click",U),P.addEventListener("click",Y),F.addEventListener("click",(function(e){if("empty"===e.target.dataset.id)return;j&&(j=!1,S.innerText="Pause",Q());const n=e.target.clientWidth,o=e.target.offsetLeft+n/2,s=e.target.offsetTop+n/2;document.elementFromPoint(o-n,s)&&"empty"===document.elementFromPoint(o-n,s).dataset.id?ee(e.target,document.elementFromPoint(o-n,s),!1):document.elementFromPoint(o,s-n)&&"empty"===document.elementFromPoint(o,s-n).dataset.id?ee(e.target,document.elementFromPoint(o,s-n),!1):document.elementFromPoint(o+n,s)&&"empty"===document.elementFromPoint(o+n,s).dataset.id?ee(e.target,document.elementFromPoint(o+n,s),!1):document.elementFromPoint(o,s+n)&&"empty"===document.elementFromPoint(o,s+n).dataset.id?ee(e.target,document.elementFromPoint(o,s+n),!1):V||t.play()})),$.addEventListener("click",U),v.addEventListener("click",(function(e){const{size:t}=e.target.dataset;f.classList.contains("opened")&&document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27})),t>0&&(W=Number(t),A.length=0,Y())})),L.addEventListener("click",(function(e){const t=e.target.dataset.tilesstyle;f.classList.contains("opened")&&document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27})),"numbers"===t?(K="numbers",Y()):"images"===t&&(K="images",Y())})),x.addEventListener("click",(function(){m(D);const e=F.children;let t=0,n=0;for(let o=0;o<e.length;o+=1)n>=W&&(n=0,t+=1),"empty"===e[o].dataset.id?A[t][n]=0:A[t][n]=+e[o].dataset.id,n+=1;const o=function(e){const t=[];function n(e,t){for(let n=0;n<e.length;n+=1)for(let o=0;o<e[n].length;o+=1)if(e[n][o]===t)return[n,o];return[null,null]}function o(e,n,o,s){const[a,i,d,r]=[e,n,o,s];return"u"===r?(a[i][d]=a[i-1][d],a[i-1][d]=0,t.push("up"),[a,i-1,d]):"d"===r?(a[i][d]=a[i+1][d],a[i+1][d]=0,t.push("down"),[a,i+1,d]):"r"===r?(a[i][d]=a[i][d+1],a[i][d+1]=0,t.push("right"),[a,i,d+1]):"l"===r?(a[i][d]=a[i][d-1],a[i][d-1]=0,t.push("left"),[a,i,d-1]):null}function s(e,t,n){let[s,a,i]=[e,t,n];const d=s.length;for(;a!==d-1;)[s,a,i]=o(s,a,i,"d");for(;i!==d-1;)[s,a,i]=o(s,a,i,"r");return s}function a(e,t){const s=t;let a=e;const i=a.length,[d,r]=n(a,s);let[l,c]=[i-1,i-1];if(d!==i-1){for(;c!==r;)[a,l,c]=o(a,l,c,"l");for(;l!==d+1;)[a,l,c]=o(a,l,c,"u")}else{for(;c!==r+1;)[a,l,c]=o(a,l,c,"l");[a,l,c]=o(a,l,c,"u"),[a,l,c]=o(a,l,c,"l"),[a,l,c]=o(a,l,c,"d")}return[a,l,c]}function i(e,t,n,o){const[i,d,r]=[t,n,o];let l=e;return l=s(l,i,d),a(l,r)}function d(e,t,n,s){const a=s;let[i,d,r]=[e,t,n];return"r"===a?([i,d,r]=o(i,d,r,"r"),[i,d,r]=o(i,d,r,"u"),[i,d,r]=o(i,d,r,"l"),[i,d,r]=o(i,d,r,"d"),[i,d,r]=o(i,d,r,"r")):"l"===a?([i,d,r]=o(i,d,r,"l"),[i,d,r]=o(i,d,r,"u"),[i,d,r]=o(i,d,r,"r"),[i,d,r]=o(i,d,r,"d"),[i,d,r]=o(i,d,r,"l")):"ur"===a?([i,d,r]=o(i,d,r,"r"),[i,d,r]=o(i,d,r,"u"),[i,d,r]=o(i,d,r,"u"),[i,d,r]=o(i,d,r,"l"),[i,d,r]=o(i,d,r,"d")):"ul"===a&&([i,d,r]=o(i,d,r,"l"),[i,d,r]=o(i,d,r,"u"),[i,d,r]=o(i,d,r,"u"),[i,d,r]=o(i,d,r,"r"),[i,d,r]=o(i,d,r,"d")),[i,d,r]}function r(e,t,n,s){const a=s;let[i,r,l]=[e,t,n];const c=i.length,m=Math.floor((a-1)/c);let u=(a-1)%c;if(u<c-2){for(;l!==u;)[i,r,l]=d(i,r,l,l<u?"r":"l");for(;r!==m+1;)[i,r,l]=d(i,r,l,"ur")}else if(u===c-2){for(u=c-1;l!==u;)[i,r,l]=d(i,r,l,"r");for(;r!==m+1;)[i,r,l]=d(i,r,l,"ul")}else if(r!==m+1){for(;l!==u;)[i,r,l]=d(i,r,l,"r");for(;r!==m+1;)[i,r,l]=d(i,r,l,"ul")}else"urddluurdlurdldrulurd".split("").forEach((e=>{[i,r,l]=o(i,r,l,e)}));return[i,r,l]}return function(e){let l=e;const c=l.length;let[m,u]=n(l,0);for(let e=1;e<1+c*(c-2);e+=1)[l,m,u]=i(l,m,u,e),[l,m,u]=r(l,m,u,e);for(let e=1;e<c-1;e+=1){const t=e+(c-2)*c;if([l,m,u]=i(l,m,u,t),[l,m,u]=r(l,m,u,t),l=s(l,m,u),l[c-1][e-1]===t+c)m=c-1,u=c-1;else{for([l,m,u]=a(l,t+c);u!==e;)[l,m,u]=d(l,m,u,"l");[l,m,u]=d(l,m,u,"r"),"llurdruldrulldr".split("").forEach((e=>{[l,m,u]=o(l,m,u,e)}))}}[l,m,u]=i(l,m,u,c*(c-1)-1),u===c-1&&([l,m,u]=d(l,m,u,"l")),[l,m,u]=o(l,m,u,"r");let p=[...t];t.length=0;let f=p.join();for(;/right,left|left,right|up,down|down,up/.test(f);)f=f.replace(/right,left|left,right|up,down|down,up/g,"").replace(/,+/g,",");return p=f.split(","),l[c-1][c-2]!==c*c-1?null:p}(e)}(A);f.classList.contains("opened")&&document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27})),j&&U();for(let e=0;e<o.length;e+=1)"left"===o[e]?D.push(setTimeout((()=>document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:39}))),350*e)):"right"===o[e]?D.push(setTimeout((()=>document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:37}))),350*e)):"up"===o[e]?D.push(setTimeout((()=>document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:40}))),350*e)):"down"===o[e]&&D.push(setTimeout((()=>document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:38}))),350*e))})),k.addEventListener("click",(function(){V=!V,V?(k.innerHTML=d,o.pause()):(k.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="30" height="30" viewBox="0 0 75 75">\n<path d="M39.389,13.769 L22.235,28.606 L6,28.606 L6,47.699 L21.989,47.699 L39.389,62.75 L39.389,13.769z" style="stroke:#111;stroke-width:5;stroke-linejoin:round;fill:#111;"/>\n<path d="M48,27.6a19.5,19.5 0 0 1 0,21.4M55.1,20.5a30,30 0 0 1 0,35.6M61.6,14a38.8,38.8 0 0 1 0,48.6" style="fill:none;stroke:#111;stroke-width:5;stroke-linecap:round"/>\n</svg>',o.play())})),C.addEventListener("click",te),document.addEventListener("keydown",(function(e){const t=document.querySelector('[data-id="empty"]'),n=t.clientWidth,o=t.offsetLeft+n/2,s=t.offsetTop+n/2;37===e.keyCode&&document.elementFromPoint(o+n,s)&&document.elementFromPoint(o+n,s).dataset.id>0&&ee(document.elementFromPoint(o+n,s),t,!1),39===e.keyCode&&document.elementFromPoint(o-n,s)&&document.elementFromPoint(o-n,s).dataset.id>0&&ee(document.elementFromPoint(o-n,s),t,!1),38===e.keyCode&&document.elementFromPoint(o,s+n)&&document.elementFromPoint(o,s+n).dataset.id>0&&ee(document.elementFromPoint(o,s+n),t,!1),40===e.keyCode&&document.elementFromPoint(o,s-n)&&document.elementFromPoint(o,s-n).dataset.id>0&&ee(document.elementFromPoint(o,s-n),t,!1),27===e.keyCode&&f.classList.contains("opened")&&(te(),C.classList.remove("opened"))})),E.addEventListener("click",(function(){V||a.play(),function(){const e=F.children;let t=0,n=0;for(let o=0;o<e.length;o+=1)t>=W&&(t=0,n+=1),"empty"===e[o].dataset.id?A[n][t]=0:A[n][t]=+e[o].dataset.id,t+=1}();const e={board:A,boardSize:W,tilesStyle:K,movesCount:G,timeCount:O,randomImageNumber:R};f.classList.contains("opened")&&document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27})),j||U();const t=document.createTextNode("Game is Saved!");$.innerHTML=i,$.appendChild(t),setTimeout((()=>$.childNodes.length>1?$.removeChild(t):null),1e3),localStorage.setItem("savedGame",JSON.stringify(e))})),T.addEventListener("click",(function(){V||a.play();let e=localStorage.getItem("savedGame");if(!e)return;f.classList.contains("opened")&&document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27})),j||U();const t=document.createTextNode("Game is Loaded!");$.innerHTML=i,$.appendChild(t),setTimeout((()=>$.childNodes.length>1?$.removeChild(t):null),1e3),e=JSON.parse(localStorage.getItem("savedGame")),W=e.boardSize,G=e.movesCount,O=e.timeCount,K=e.tilesStyle,"images"===K&&(R=e.randomImageNumber),q(e.board.flat().reverse()),X()})),w.addEventListener("click",(function(){f.classList.contains("opened")&&document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:27})),j||U();const e=JSON.parse(localStorage.getItem("bestScores"));if(!e)return void($.innerHTML="No scores recorded.");const t=e.map(((e,t)=>`<tr><td>${t+1}</td><td>${e.boardSize}X${e.boardSize}</td><td>${e.moves}</td><td>${e.minutes.toString().padStart(2,"0")}:${e.seconds.toString().padStart(2,"0")}</td></tr>`));$.innerHTML=`<span class="scores">Best Scores:</span><table><tr><th>#</th><th>size</th><th>moves</th><th>time</th></tr>${t.join("")}</table>`})),F.addEventListener("dragstart",(function(e){e.target.classList.add("drag"),e.dataTransfer.setData("text",e.target.dataset.id),e.dataTransfer.effectAllowed="move",setTimeout((()=>e.target.classList.add("invisible")),0)})),F.addEventListener("dragend",(function(e){e.target.classList.remove("drag"),e.target.classList.remove("invisible")})),F.addEventListener("dragover",(function(e){e.preventDefault()})),F.addEventListener("drop",(function(e){if("empty"!==e.target.dataset.id)return;const t=e.dataTransfer.getData("text"),n=e.target.clientWidth,o=e.target.offsetLeft+n/2,s=e.target.offsetTop+n/2;document.elementFromPoint(o-n,s)&&document.elementFromPoint(o-n,s).dataset.id===t?ee(document.elementFromPoint(o-n,s),e.target,!0):document.elementFromPoint(o,s-n)&&document.elementFromPoint(o,s-n).dataset.id===t?ee(document.elementFromPoint(o,s-n),e.target,!0):document.elementFromPoint(o+n,s)&&document.elementFromPoint(o+n,s).dataset.id===t?ee(document.elementFromPoint(o+n,s),e.target,!0):document.elementFromPoint(o,s+n)&&document.elementFromPoint(o,s+n).dataset.id===t&&ee(document.elementFromPoint(o,s+n),e.target,!0)})),window.addEventListener("resize",(function(){"images"===K&&I!==F.clientWidth&&(I=F.clientWidth,Array.from(F.children).forEach((e=>{const t=e;if("empty"!==t.dataset.id){const e=t.dataset.id,n=Math.floor((e-1)/W),o=Math.floor((e-1)%W),s=F.clientWidth/W*o,a=F.clientHeight/W*n;t.dataset.x=s,t.dataset.y=a,t.style.backgroundImage=`url("./assets/images/${R}.jpg")`,t.style.backgroundSize=`${F.clientWidth}px ${F.clientHeight}px`,t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition=`-${s}px -${a}px`}})))})),window.addEventListener("DOMContentLoaded",Y)})();